// íœ´ì§€í†µ ê¸°ëŠ¥ App.jsx ì—°ë™ ê°€ì´ë“œ
// ==========================================

/*
 * 1. import ì¶”ê°€ (íŒŒì¼ ìƒë‹¨)
 */

// ê¸°ì¡´ import ì•„ë˜ì— ì¶”ê°€:
import { TrashProvider } from './contexts/TrashContext';
import { useTrashContext } from './contexts/TrashContext';
import TrashPage from './components/TrashPage.jsx';


/*
 * 2. App ì»´í¬ë„ŒíŠ¸ ì „ì²´ë¥¼ TrashProviderë¡œ ê°ì‹¸ê¸°
 */

// ê¸°ì¡´ ì½”ë“œ:
function App() {
    // ... ê¸°ì¡´ ì½”ë“œ ...
    return (
        <>
            <GlobalStyle />
            <Screen>
                {/* ... */}
            </Screen>
        </>
    );
}

// ë³€ê²½ í›„:
function App() {
    // ... ê¸°ì¡´ ì½”ë“œ ...
    return (
        <TrashProvider autoDeleteDays={30}>
            <GlobalStyle />
            <Screen>
                {/* ... */}
            </Screen>
        </TrashProvider>
    );
}


/*
 * 3. íœ´ì§€í†µ íƒ­ ìƒíƒœ ì¶”ê°€
 */

// ê¸°ì¡´ activeTab ê´€ë ¨ ì½”ë“œ ê·¼ì²˜ì— ì¶”ê°€:
// const [activeTab, setActiveTab] = useState('home'); // ê¸°ì¡´ ì½”ë“œ


/*
 * 4. ContentArea ë‚´ë¶€ì— íœ´ì§€í†µ í˜ì´ì§€ ì¶”ê°€
 */

// ê¸°ì¡´ íƒ­ ë Œë”ë§ ë¶€ë¶„ì— ì¶”ê°€:
<ContentArea>
    {activeTab === 'home' && (/* ... ê¸°ì¡´ í™ˆ ì½”ë“œ ... */)}
    {activeTab === 'calendar' && (/* ... ê¸°ì¡´ ìº˜ë¦°ë” ì½”ë“œ ... */)}
    {activeTab === 'memo' && (/* ... ê¸°ì¡´ ë©”ëª¨ ì½”ë“œ ... */)}
    
    {/* ì¶”ê°€: íœ´ì§€í†µ íƒ­ */}
    {activeTab === 'trash' && (
        <TrashPage showToast={showToast} />
    )}
</ContentArea>


/*
 * 5. SideMenuì˜ onOpenTrash ì—°ê²°
 */

// ê¸°ì¡´ ì½”ë“œ:
<SideMenu
    // ... ê¸°ì¡´ props ...
    onOpenTrash={() => showToast('íœ´ì§€í†µ ê¸°ëŠ¥ì€ ê³§ ì œê³µë©ë‹ˆë‹¤')}
/>

// ë³€ê²½ í›„:
<SideMenu
    // ... ê¸°ì¡´ props ...
    onOpenTrash={() => {
        setIsMenuOpen(false);
        setActiveTab('trash');
    }}
/>


/*
 * 6. ë©”ëª¨/ìŠ¤ì¼€ì¤„ ì‚­ì œ ì‹œ íœ´ì§€í†µìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •
 */

// AppContent ì»´í¬ë„ŒíŠ¸ ìƒì„± (TrashProvider ë‚´ë¶€ì—ì„œ useTrashContext ì‚¬ìš©)
const AppContent = () => {
    const { moveToTrash, restoreFromTrash } = useTrashContext();
    
    // ê¸°ì¡´ handleDeleteMemo í•¨ìˆ˜ ìˆ˜ì •:
    const handleDeleteMemo = (id) => {
        const deletedMemo = memos.find(memo => memo.id === id);
        if (deletedMemo) {
            // íœ´ì§€í†µìœ¼ë¡œ ì´ë™
            moveToTrash(
                id,
                'memo',
                deletedMemo.content.substring(0, 50), // ë¯¸ë¦¬ë³´ê¸°ìš©
                deletedMemo // ë³µì›ì„ ìœ„í•œ ì›ë³¸ ë°ì´í„°
            );
            
            // ë©”ëª¨ ëª©ë¡ì—ì„œ ì œê±°
            setMemos(prevMemos => prevMemos.filter(memo => memo.id !== id));
            addActivity('ë©”ëª¨ ì‚­ì œ', deletedMemo.content, id);
            quietSync();
        }
        return deletedMemo;
    };

    // ê¸°ì¡´ executeCalendarDelete í•¨ìˆ˜ ìˆ˜ì •:
    const executeCalendarDelete = () => {
        if (!dateToDelete) return;
        const key = format(dateToDelete, 'yyyy-MM-dd');
        const deletedEntry = calendarSchedules[key];
    
        if (deletedEntry) {
            // íœ´ì§€í†µìœ¼ë¡œ ì´ë™
            moveToTrash(
                key,
                'schedule',
                `${key} - ${deletedEntry.text}`,
                { date: dateToDelete, ...deletedEntry }
            );
            
            // ìŠ¤ì¼€ì¤„ ëª©ë¡ì—ì„œ ì œê±°
            setCalendarSchedules(prev => {
                const updated = { ...prev };
                delete updated[key];
                return updated;
            });
            
            addActivity('ìŠ¤ì¼€ì¤„ ì‚­ì œ', `${key} - ${deletedEntry.text}`);
            quietSync();
        }

        showToast?.('ìŠ¤ì¼€ì¤„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ—‘ï¸');
        setIsCalendarConfirmOpen(false);
        setDateToDelete(null);
    };
    
    // ... ë‚˜ë¨¸ì§€ ê¸°ì¡´ ì½”ë“œ ...
};


/*
 * 7. ë³µì› ë¡œì§ ì¶”ê°€
 */

// useEffectë¡œ ë³µì› ì´ë²¤íŠ¸ ê°ì§€
useEffect(() => {
    const handleRestore = (event) => {
        const restoredItems = event.detail;
        
        restoredItems.forEach(item => {
            if (item.type === 'memo') {
                // ë©”ëª¨ ë³µì›
                setMemos(prev => [item.originalData, ...prev]);
                addActivity('ë©”ëª¨ ë³µì›', item.content);
            } else if (item.type === 'schedule') {
                // ìŠ¤ì¼€ì¤„ ë³µì›
                const { date, ...scheduleData } = item.originalData;
                const key = format(new Date(date), 'yyyy-MM-dd');
                setCalendarSchedules(prev => ({
                    ...prev,
                    [key]: scheduleData
                }));
                addActivity('ìŠ¤ì¼€ì¤„ ë³µì›', item.content);
            }
        });
        
        quietSync();
    };

    window.addEventListener('itemsRestored', handleRestore);
    return () => window.removeEventListener('itemsRestored', handleRestore);
}, []);


/*
 * 8. ìµœì¢… êµ¬ì¡°
 */

function App() {
    // ... ëª¨ë“  ê¸°ì¡´ ìƒíƒœì™€ í•¨ìˆ˜ë“¤ ...
    
    return (
        <TrashProvider autoDeleteDays={30}>
            <GlobalStyle />
            <Screen>
                <AppContent />
            </Screen>
        </TrashProvider>
    );
}

// TrashProvider ë‚´ë¶€ì—ì„œë§Œ useTrashContext ì‚¬ìš© ê°€ëŠ¥
const AppContent = () => {
    const { moveToTrash, restoreFromTrash } = useTrashContext();
    
    // ... ê¸°ì¡´ ëª¨ë“  ì½”ë“œ ...
    // ... moveToTrashë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì‚­ì œ ë¡œì§ ìˆ˜ì • ...
    
    return (
        <>
            <Header {...headerProps} />
            <ContentArea>
                {/* ... ëª¨ë“  íƒ­ ë Œë”ë§ ... */}
                {activeTab === 'trash' && <TrashPage showToast={showToast} />}
            </ContentArea>
            {/* ... ë‚˜ë¨¸ì§€ UI ... */}
        </>
    );
};

export default App;
