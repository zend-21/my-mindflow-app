# 📝 협업 기능 가이드

마인드플로우 앱에 추가된 **메모 협업 기능**에 대한 상세 가이드입니다.

---

## 🎯 주요 기능

### 1. **친구 관리 시스템** 👥
- 이메일/이름으로 사용자 검색
- 친구 요청 보내기/수락/거절
- 온라인/오프라인 상태 표시
- 친구 목록 관리

### 2. **메모/스케줄 공유** 📤
- 친구들과 메모/스케줄 공유
- 참여자별 권한 설정:
  - **읽기**: 내용 확인만 가능
  - **댓글**: 읽기 + 채팅 참여
  - **수정 제안**: 읽기 + 채팅 + 수정 제안 (승인 필요)
  - **관리자**: 모든 권한 (소유자)

### 3. **실시간 채팅** 💬
- 공유된 메모/스케줄에서 실시간 대화
- 읽음 표시
- 메시지 히스토리

### 4. **수정 제안 시스템** ✏️
- 원본 내용 보호
- 수정 제안 작성
- 원본과 수정안 비교 보기 (취소선 + 하이라이트)
- 소유자가 승인/거절
- 승인 시 자동 반영

### 5. **공유 메모 목록** 📋
- 내가 공유한 메모
- 나와 공유된 메모
- 읽지 않은 메시지 표시
- 메모/스케줄 필터링

---

## 🚀 사용 방법

### 1단계: 친구 추가

1. 좌측 상단 **메뉴(☰)** 클릭
2. **"👥 친구 관리"** 선택
3. **"친구 찾기"** 탭 클릭
4. 이메일 또는 이름으로 검색
5. **"추가"** 버튼 클릭

### 2단계: 메모/스케줄 공유

1. 메모 상세 화면 열기
2. **"공유"** 버튼 클릭 (중요 체크박스 옆)
3. 공유할 친구 선택
4. 친구별 권한 설정:
   - 읽기만 가능하게 할지
   - 댓글(채팅) 가능하게 할지
   - 수정 제안까지 가능하게 할지
5. **"공유하기"** 버튼 클릭

### 3단계: 공유된 메모 확인

1. 좌측 상단 **메뉴(☰)** 클릭
2. **"📝 공유된 메모"** 선택
3. 보고 싶은 메모 클릭
4. 두 가지 탭 사용:
   - **"내용"** 탭: 메모 내용 보기/수정 제안
   - **"채팅"** 탭: 실시간 대화

### 4단계: 실시간 채팅

1. 공유된 메모 열기
2. **"채팅"** 탭 클릭
3. 하단 입력창에 메시지 입력
4. **전송(▶️)** 버튼 클릭 또는 Enter

### 5단계: 수정 제안 (권한이 있을 때)

1. 공유된 메모 열기
2. **"내용"** 탭에서 **"수정 제안하기"** 버튼 클릭
3. 수정할 내용 입력
4. **"수정 제안하기"** 버튼 클릭

### 6단계: 수정 제안 승인/거절 (소유자)

1. 공유한 메모 열기
2. **"내용"** 탭에서 대기 중인 수정 제안 확인
3. 원본과 수정안 비교
4. **"승인"** 또는 **"거절"** 버튼 클릭

---

## 📱 사용 시나리오

### 시나리오 1: 바캉스 준비물 체크리스트

**상황**: 친구들과 바캉스를 가는데 준비물을 분담해서 구매

1. **준비물 메모 작성**
   ```
   삼겹살 2kg
   마늘 500g
   상추 5봉지
   생수 2L 5개
   쌀 5kg
   ```

2. **친구 A, B, C와 공유** (권한: 수정 제안)

3. **실시간 협업**
   - A: "제가 삼겹살 살게요!" (채팅)
   - A: 삼겹살 항목 삭제 제안
   - 소유자: 승인 → 메모에서 삼겹살 삭제됨
   - B: "상추 3봉지만 사도 될 것 같아요"
   - B: 상추 수량 수정 제안
   - 소유자: 승인 → "상추 3봉지"로 변경

4. **결과**: 실시간으로 준비물이 체크되며 중복 구매 방지

### 시나리오 2: 회의록 실시간 작성

**상황**: 온라인 회의 중 회의록 작성

1. **회의록 메모 생성** → 참석자들과 공유 (권한: 댓글)

2. **회의 진행 중**
   ```
   참석자들이 실시간 댓글:
   A: "이 부분 기록 부탁드려요"
   B: "결정사항: ○○○"
   C: "다음 회의 일정은 ○○일로"
   ```

3. **회의 후**
   - 모든 참석자가 동일한 회의록 확인
   - 추가 의견은 채팅으로 공유

### 시나리오 3: 스터디 노트 공유

**상황**: 스터디 그룹에서 함께 공부

1. **"React 공부" 메모 작성** → 스터디원들과 공유 (권한: 수정 제안)

2. **협업 학습**
   ```
   A: "useState 개념 정리" (수정 제안)
   B: "이 부분 이렇게 수정하면 어떨까요?" (채팅)
   소유자: 승인 → 내용 업데이트
   C: "다음은 useEffect를 정리해볼까요?" (채팅)
   ```

3. **결과**: 모두가 기여한 완성도 높은 학습 자료 완성

---

## 🎨 UI/UX 가이드

### 공유 버튼 위치
- **메모 상세 화면**: "중요" 체크박스 옆에 🔗 아이콘

### 메뉴 구조
```
☰ 메뉴
├─ ⚙️ 매크로
├─ 🔮 오늘의 운세
├─ ⏱️ 타이머
├─ ────────────
├─ 👥 친구 관리 (로그인 필수)
├─ 📝 공유된 메모 (로그인 필수)
├─ ────────────
├─ 💾 휴대폰 백업
└─ ...
```

### 공유 메모 화면 구조
```
┌─────────────────────────┐
│  📝 메모 제목           │
│  작성자: OOO   👥 3명   │
├─────────────────────────┤
│  [내용] [채팅]          │ ← 탭
├─────────────────────────┤
│                         │
│  메모 내용 또는         │
│  채팅 메시지            │
│                         │
├─────────────────────────┤
│  💬 메시지 입력...  [▶] │
└─────────────────────────┘
```

---

## 🔐 보안 및 권한

### 권한 레벨 상세

| 권한 | 읽기 | 채팅 | 수정 제안 | 승인/거절 | 참여자 추가 |
|------|------|------|-----------|-----------|-------------|
| **읽기** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **댓글** | ✅ | ✅ | ❌ | ❌ | ❌ |
| **수정 제안** | ✅ | ✅ | ✅ | ❌ | ❌ |
| **관리자** | ✅ | ✅ | ✅ | ✅ | ✅ |

### 데이터 보호
- ✅ 원본 메모는 소유자 승인 없이 절대 수정 불가
- ✅ 수정 제안은 별도 저장되어 원본 보호
- ✅ 모든 변경사항은 이력 추적 가능
- ✅ Firestore Security Rules로 서버 레벨 보안

---

## 💾 데이터 구조

### 공유 메모 (sharedNotes)
```javascript
{
  id: "note123",
  type: "memo", // 또는 "schedule"
  ownerId: "user1",
  ownerName: "홍길동",
  title: "바캉스 준비물",
  content: "삼겹살 2kg, 마늘 500g...",
  createdAt: 1234567890,
  updatedAt: 1234567890,
  participants: {
    "user1": {
      permission: "admin",
      joinedAt: 1234567890,
      displayName: "홍길동"
    },
    "user2": {
      permission: "edit",
      joinedAt: 1234567890,
      displayName: "김철수"
    }
  },
  readBy: {
    "user1": 1234567890,
    "user2": 1234567890
  }
}
```

### 채팅 메시지 (chatMessages)
```javascript
{
  id: "msg123",
  roomId: "note123",
  userId: "user2",
  userName: "김철수",
  type: "text",
  content: "제가 삼겹살 살게요!",
  createdAt: 1234567890,
  readBy: {
    "user1": 1234567890,
    "user2": 1234567890
  }
}
```

### 수정 제안 (editSuggestions)
```javascript
{
  id: "edit123",
  noteId: "note123",
  userId: "user2",
  userName: "김철수",
  originalContent: "삼겹살 2kg",
  suggestedContent: "", // 삭제 제안
  status: "pending", // 또는 "approved", "rejected"
  createdAt: 1234567890
}
```

---

## 🐛 문제 해결

### 1. 친구 검색이 안 돼요
- ✅ 인터넷 연결 확인
- ✅ Firebase Authentication 로그인 상태 확인
- ✅ Firestore Security Rules 설정 확인

### 2. 공유 버튼이 안 보여요
- ✅ 최신 버전으로 업데이트
- ✅ 로그인 상태 확인

### 3. 메시지가 전송 안 돼요
- ✅ 인터넷 연결 확인
- ✅ 공유 메모의 권한 확인 (댓글 이상 필요)

### 4. 수정 제안이 안 보여요
- ✅ "내용" 탭에 있는지 확인 (채팅 탭 아님)
- ✅ 수정 제안 권한이 있는지 확인
- ✅ 소유자만 대기 중인 제안을 볼 수 있음

---

## 📊 성능 최적화

### 실시간 리스너 관리
- 공유 메모 화면을 닫으면 자동으로 리스너 해제
- 메모리 누수 방지

### 페이지네이션
- 채팅 메시지: 최신 100개만 로드
- 공유 메모 목록: 스크롤 시 추가 로드

### 캐싱
- 친구 목록: 로컬 캐시
- 프로필 이미지: 브라우저 캐시

---

## 🚀 향후 개선 사항

### Phase 2 (선택적)
- [ ] 파일 첨부 기능
- [ ] 이미지 공유
- [ ] 음성 메시지
- [ ] 비디오 통화
- [ ] 화면 공유

### Phase 3 (고급)
- [ ] 오프라인 지원
- [ ] 종단 간 암호화
- [ ] 그룹 채팅방 (메모와 독립)
- [ ] 멘션 기능 (@user)
- [ ] 반응 이모지

---

## 📞 지원

문제가 발생하거나 제안사항이 있으시면:
- GitHub Issues
- 이메일: support@mindflow.com
- 디스코드: MindFlow Community

---

## 📄 라이선스

이 프로젝트는 MIT 라이선스를 따릅니다.

---

**Happy Collaborating! 🎉**
